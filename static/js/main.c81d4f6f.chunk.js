(this.webpackJsonpannotator=this.webpackJsonpannotator||[]).push([[0],{139:function(e,t,n){e.exports=n(244)},144:function(e,t,n){},150:function(e,t,n){},180:function(e,t){},244:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(24),o=n.n(c),i=n(35),s=(n(144),n(11)),l=n(12),u=n(14),d=n(13),p=n(15),h=n(9),f=n(36),g=n(25),v=n(131),m=n(65),y=n.n(m);var I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;return"CHANGE_USERNAME"===t.type?(y.a.set("username",t.username),t.username):e},b=n(18);function E(e,t){return e.articleId===t.articleId&&e.sentenceIndex===t.sentenceIndex&&e.annotator===t.annotator&&e.category===t.category}var O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_ANNOTATION":for(var n=0;n<e.length;n++)if(E(t.annotation,e[n]))return e;return[].concat(Object(b.a)(e),[t.annotation]);case"REMOVE_ANNOTATION":for(var a=0;a<e.length;a++)if(E(t.annotation,e[a]))return[].concat(Object(b.a)(e.slice(0,a)),Object(b.a)(e.slice(a+1)));break;case"UPDATE_ANNOTATION_RANK":for(var r=t.annotation,c=0;c<e.length;c++)if(E(r,e[c]))return[].concat(Object(b.a)(e.slice(0,c)),[r],Object(b.a)(e.slice(c+1)))}return e},A=n(47),T=n(10),j={loadedArticles:[],categoryToArticleIdListMap:{}};var C=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"ADD_ARTICLE":e=n.article;for(var a=0;a<t.loadedArticles.length;a++)if(t.loadedArticles[a].id===e.id&&t.loadedArticles[a].category===e.category)return Object(T.a)({},t,{loadedArticles:[].concat(Object(b.a)(t.loadedArticles.slice(0,a)),[e],Object(b.a)(t.loadedArticles.slice(a+1)))});return Object(T.a)({},t,{loadedArticles:[].concat(Object(b.a)(t.loadedArticles),[e])});case"REMOVE_ARTICLE":e=n.article;for(var r=0;r<t.loadedArticles.length;r++)if(t.loadedArticles[r]===e)return Object(T.a)({},t,{loadedArticles:[].concat(Object(b.a)(t.loadedArticles.slice(0,r)),Object(b.a)(t.loadedArticles.slice(r+1)))});break;case"UPDATE_CATEGORY_ARTICLE_LIST":var c=n,o=c.category,i=c.articleIds;return Object(T.a)({},t,{categoryToArticleIdListMap:Object(T.a)({},t.categoryToArticleIdListMap,Object(A.a)({},o,i))});case"UPDATE_PARAGRAPH_TO_SENTENCES":e=n.article;for(var s=n,l=s.paragraphIndex,u=s.sentences,d=0;d<t.loadedArticles.length;d++){var p=t.loadedArticles[d];if(p.id===e.id&&p.category===e.category)return(p=Object(T.a)({},p)).paragraphToSentences=p.paragraphToSentences||[],p.paragraphToSentences[l]=u,Object(T.a)({},t,{loadedArticles:[].concat(Object(b.a)(t.loadedArticles.slice(0,d)),[p],Object(b.a)(t.loadedArticles.slice(d+1)))})}}return t},x={annotatorToColorMap:{},annotatorToAnnotatorsMap:{},existingCombinations:[]};var N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CHANGE_COLOR":var n=t.username,a=t.color;return Object(T.a)({},e,{annotatorToColorMap:Object(T.a)({},e.annotatorToColorMap,Object(A.a)({},n,a))});case"ADD_COLORS_TO_DOCUMENT":if(!e.existingCombinations.includes(t.className))return Object(T.a)({},e,{existingCombinations:[].concat(Object(b.a)(e.existingCombinations),[t.className])})}return e};var k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CHANGE_SELECTED_TEXT":return Object(T.a)({},e,{selectedSentence:t.selectedText});case"SET_CURRENT_ARTICLE":var n=t,a=n.articleId,r=n.category;return Object(T.a)({},e,{currentArticle:{articleId:a,category:r}})}return e},S=["rgb(214, 157, 177)","rgb(255, 227, 134)","rgb(190, 144, 212)","rgb(141, 195, 234)","rgb(215, 186, 229)","rgba(0, 181, 204, 1)","rgb(140, 20, 252)","rgb(241, 169, 160)","rgb(169, 222, 204)","rgb(145, 61, 136)","rgb(226, 106, 106)","rgb(118, 93, 105)","rgb(154, 18, 179)"];function _(e,t){return{type:"SET_CURRENT_ARTICLE",articleId:e,category:t}}function R(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return{type:"ADD_ANNOTATION",annotation:{articleId:e,category:t,sentenceIndex:n,annotator:a,rank:r}}}function D(e,t,n,a){return{type:"REMOVE_ANNOTATION",annotation:{articleId:e,category:t,sentenceIndex:n,annotator:a}}}var L=n(16),M=function(e){return e.colors},w=Object(L.a)(M,(function(e){return e.annotatorToColorMap})),U=Object(L.a)(M,(function(e){return e.existingCombinations})),P=function(e){return e.articles},H=Object(L.a)(P,(function(e){return e.categoryToArticleIdListMap})),V=Object(L.a)(P,(function(e){return e.loadedArticles})),G=function(e){return Object(L.a)(H,(function(t){return t[e]}))},X=function(e,t){return Object(L.a)(G(t),(function(t){if(!t)return-1;var n=t.indexOf(e);return n<=0?-1:t[n-1]}))},F=function(e,t){return Object(L.a)(G(t),(function(t){if(!t)return-1;var n=t.indexOf(e);return n<0||n+1===t.length?-1:t[n+1]}))},K=function(e,t){return Object(L.a)(V,(function(n){var a=!0,r=!1,c=void 0;try{for(var o,i=n[Symbol.iterator]();!(a=(o=i.next()).done);a=!0){var s=o.value;if(s.id===e&&s.category===t)return s}}catch(l){r=!0,c=l}finally{try{a||null==i.return||i.return()}finally{if(r)throw c}}}))},q=function(e,t,n){return Object(L.a)(K(e,t),(function(e){if(void 0!==e)return e.sentences[n]}))},W=function(e){return e.username},Y=Object(L.a)(W,(function(e){return void 0!==e&&e.length>0})),B=n(31),z=n.n(B),J=function(e){return e.annotations},Q=function(e,t){return Object(L.a)(J,(function(n){return n.filter((function(n){return n.articleId===e&&n.category===t}))}))},Z=function(e,t,n){return Object(L.a)(Q(e,t),(function(e){return e.filter((function(e){return e.sentenceIndex===n}))}))},$=function(e,t,n){return Object(L.a)(W,Z(e,t,n),(function(e,t){var n=!0,a=!1,r=void 0;try{for(var c,o=t[Symbol.iterator]();!(n=(c=o.next()).done);n=!0){if(c.value.annotator===e)return!0}}catch(i){a=!0,r=i}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}return!1}))},ee=function(e){return e.utils},te=function(e){return ee(e).currentArticle},ne=function(e){return ee(e).selectedSentence},ae=function(e,t,n,a,r){var c=ee(e);if(!c.selectedSentence)return!1;var o=c.selectedSentence;return"DESELECT"!==o.selectedIn&&(o.articleId===t&&o.sentenceIndex===a&&o.category===n&&r!==o.selectedIn)},re={username:y.a.get("username"),colors:{annotatorToColorMap:{},annotatorToAnnotatorsMap:{},existingCombinations:[]},articles:{categoryToArticleIdListMap:{},loadedArticles:[]},annotations:[],utils:{}},ce=Object(g.c)({username:I,annotations:O,articles:C,colors:N,utils:k}),oe=Object(g.e)(ce,re,Object(g.a)(v.a)),ie=(n(150),n(132));var se=function(e,t){if(0!==t.length){var n=document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",a.innerHTML=".".concat(e," {").concat(t,"}"),n.appendChild(a)}};function le(e){for(var t="",n=0;n<e.length;n++)if(e[n]>="a"&&e[n]<="z")t+=e[n];else if(e[n]>="A"&&e[n]<="Z")t+=e[n];else{for(var a=encodeURIComponent(e[n]);a.indexOf("%")>=0;)a=a.replace("%","---");t+=a}return t}var ue=function(e){return z.a.isString(e)&&(e=[e]),0===e.length?"":(e=z.a.uniq(e).sort(),"highlight-".concat(e.map(le).join("-")))};var de=function(e,t){if(z.a.isString(t)&&(t=[t]),0===t.length)return"";t=z.a.uniq(t).sort();var n=!0,a=!1,r=void 0;try{for(var c,o=t[Symbol.iterator]();!(n=(c=o.next()).done);n=!0){var i=c.value;if(!e[i]){var s=void 0,l=!0,u=!1,d=void 0;try{for(var p,h=S[Symbol.iterator]();!(l=(p=h.next()).done);l=!0){var f=p.value,g=!1;for(var v in e)if(e[v]===f){g=!0;break}if(!g){s=f;break}}}catch(O){u=!0,d=O}finally{try{l||null==h.return||h.return()}finally{if(u)throw d}}s||(s=S[Math.floor(Math.random()*S.length)]),oe.dispatch({type:"CHANGE_COLOR",username:i,color:s}),e[i]=s}}}catch(O){a=!0,r=O}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}var m="background-image: linear-gradient(";if(1===t.length){var y=e[t[0]];return m+="transparent 0px, transparent 50%, ".concat(y," 0px, ").concat(y,");")}for(var I=0;I<t.length;I++){var b=t[I],E=e[b];m+="".concat(E," 0px, ").concat(E," ").concat(100*(I+1)/t.length,"%"),t.indexOf(b)!==t.length-1?m+=",":m+=");"}return m};var pe=function(e){var t=ue(e);if(!function(e){return Object(L.a)(U,(function(t){return t.includes(e)}))}(t)(oe.getState())){var n=de(w(oe.getState()),e);se(t,n),oe.dispatch(function(e){return{type:"ADD_COLORS_TO_DOCUMENT",className:e}}(t))}},he=n(133),fe=n.n(he)()("https://backend.annotator.zehua.li/"),ge=function(e){fe.emit("refresh article list",{category:e},(function(t){oe.dispatch({type:"UPDATE_CATEGORY_ARTICLE_LIST",category:e,articleIds:t})}))};fe.on("add annotation",(function(e){var t=e.articleId,n=e.category,a=e.annotator,r=e.sentenceIndex;oe.dispatch(R(t,n,r,a))})),fe.on("remove annotation",(function(e){var t=e.articleId,n=e.category,a=e.annotator,r=e.sentenceIndex;oe.dispatch(D(t,n,r,a))})),fe.on("update annotation rank",(function(e){oe.dispatch({type:"UPDATE_ANNOTATION_RANK",annotation:e})}));var ve=fe,me=function(e){var t=te(oe.getState());if(t){var n=K(t.articleId,t.category)(oe.getState());if(n){var a=n.sentences,r=ne(oe.getState());(!r||r.articleId!==t.articleId||r.articleId<0)&&(r=Object(T.a)({},t,{sentenceIndex:-e,selectedIn:"HOT_KEY"})),r.sentenceIndex+=e,r.sentenceIndex=Math.min(a.length-1,r.sentenceIndex),r.sentenceIndex=Math.max(0,r.sentenceIndex),r.selectedIn="HOT_KEY",ye(),oe.dispatch({type:"CHANGE_SELECTED_TEXT",selectedText:r})}}},ye=function(){var e=ne(oe.getState());if(e)return oe.dispatch({type:"CHANGE_SELECTED_TEXT",selectedText:Object(T.a)({},e,{selectedIn:"DESELECT"})});oe.dispatch({type:"CHANGE_SELECTED_TEXT",selectedText:{articleId:-1,category:"",sentenceIndex:-1,selectedIn:"DESELECT"}})},Ie=function(e){var t=te(oe.getState());if(t){var n=G(t.category)(oe.getState()),a=n.indexOf(t.articleId)+e;a=Math.min(n.length-1,a),a=Math.max(0,a),oe.dispatch(_(n[a],t.category)),window.history.pushState(null,"","/article-annotator/".concat(t.category,"/").concat(n[a]))}},be={ENTER:["enter","k"],MOVE_UP:["w","h"],MOVE_DOWN:["s","j"],DESELECT:["q","l"],LAST_ARTICLE:["[","y"],NEXT_ARTICLE:["]","u"]},Ee={ENTER:function(){var e=ne(oe.getState());if(e&&!(e.articleId<0)){var t=W(oe.getState());if(t){var n=e.articleId,a=e.category,r=e.sentenceIndex,c=$(n,a,r)(oe.getState());c?oe.dispatch(D(n,a,r,t)):oe.dispatch(R(n,a,r,t)),ve.emit("".concat(c?"remove":"add"," annotation"),Object(T.a)({},e,{annotator:t,rank:0}))}}},MOVE_UP:function(){return me(-1)},MOVE_DOWN:function(){return me(1)},DESELECT:ye,LAST_ARTICLE:function(){return Ie(-1)},NEXT_ARTICLE:function(){return Ie(1)}},Oe=Object(h.b)((function(e){var t,n;return{articleId:null===(t=te(e))||void 0===t?void 0:t.articleId,category:null===(n=te(e))||void 0===n?void 0:n.category,isUserLoggedIn:Y(e)}}),(function(e){return{setCurrentArticle:function(t,n){e(_(t,n))}}})),Ae=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.onRouteChanged()}},{key:"componentDidUpdate",value:function(e){this.props.location!==e.location&&this.onRouteChanged()}},{key:"onRouteChanged",value:function(){this.leaveArticle();var e=this.props.match,t=+e.params.articleId,n=e.params.category;this.props.setCurrentArticle(t,n),ve.emit("join article",{articleId:t,category:n}),window.scrollTo(0,0)}},{key:"leaveArticle",value:function(){if(this.props.articleId&&this.props.category){var e=this.props,t=e.articleId,n=e.category;ve.emit("leave article",{articleId:t,category:n})}}},{key:"render",value:function(){if(!this.props.articleId||!this.props.category)return r.a.createElement("div",{className:"annotation-panel-container"});var e=this.props,t=e.articleId,n=e.category;return r.a.createElement("div",{className:"annotation-panel-container"},r.a.createElement(Ue,{articleId:t,category:n}),r.a.createElement(De,{articleId:t,category:n}),r.a.createElement(ie.GlobalHotKeys,{keyMap:be,handlers:Ee}))}}]),t}(r.a.Component),Te=Object(f.g)(Oe(Ae)),je=n(69),Ce=function(e,t){return{article:K(t.articleId,t.category)(e)}},xe=(Object(h.b)(Ce),function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){if(!this.props.article)return r.a.createElement("div",null);var e=this.props.article,t=e.question,n=e.explanation;return r.a.createElement("p",{className:"explanation"},r.a.createElement("b",null,r.a.createElement("i",null,t)),r.a.createElement("br",null),n)}}]),t}(r.a.Component)),Ne=Object(h.b)(Ce)(xe),ke=n(68),Se=Object(h.b)((function(e,t){return{sentence:q(t.articleId,t.category,t.sentenceIndex)(e),checked:$(t.articleId,t.category,t.sentenceIndex)(e),username:W(e),shouldScrollIntoView:ae(e,t.articleId,t.category,t.sentenceIndex,"ANNOTATION_SECTION")}}),(function(e){return{addAnnotation:function(t,n,a,r){e({type:"ADD_ANNOTATION",annotation:{articleId:t,category:n,sentenceIndex:a,annotator:r}})},removeAnnotation:function(t,n,a,r){e({type:"REMOVE_ANNOTATION",annotation:{articleId:t,category:n,sentenceIndex:a,annotator:r}})},changeSelectedText:function(t,n,a){e({type:"CHANGE_SELECTED_TEXT",selectedText:{articleId:t,category:n,sentenceIndex:a,selectedIn:"ANNOTATION_SECTION"}})}}}))(function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(c)))).divRef=r.a.createRef(),n.handleClick=function(){if(n.props.username){var e=n.props,t=e.articleId,a=e.category,r=e.sentenceIndex,c=e.username;n.props.checked?n.props.removeAnnotation(t,a,r,c):n.props.addAnnotation(t,a,r,c),ve.emit(n.props.checked?"remove annotation":"add annotation",{articleId:t,category:a,sentenceIndex:r,annotator:c})}},n.handleContextMenu=function(e){e.preventDefault();var t=n.props,a=t.articleId,r=t.category,c=t.sentenceIndex;n.props.changeSelectedText(-1,"",-1),setTimeout((function(){return n.props.changeSelectedText(a,r,c)}),0)},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this;if(e.shouldScrollIntoView!==this.props.shouldScrollIntoView&&this.props.shouldScrollIntoView){if(!this.divRef||!this.divRef.current)return;Object(ke.a)(this.divRef.current,{behavior:"smooth"}),this.divRef.current.classList.add("selected-sentence-card"),setTimeout((function(){var e;return null===(e=t.divRef.current)||void 0===e?void 0:e.classList.remove("selected-sentence-card")}),1500)}}},{key:"render",value:function(){return r.a.createElement("div",{ref:this.divRef,onClick:this.handleClick,onContextMenu:this.handleContextMenu,className:"sentence-card ".concat(this.props.checked?"checked":"")},r.a.createElement("p",null,this.props.sentence),r.a.createElement("div",{className:"side"},r.a.createElement("span",null,this.props.index)),r.a.createElement("div",{className:"sentence-card-background"}))}}]),t}(r.a.Component)),_e=Object(h.b)((function(e,t){return{annotatedSentences:(n=t.articleId,a=t.category,Object(L.a)(J,W,(function(e,t){var r=e.filter((function(e){return e.articleId===n&&e.category===a})).sort((function(e,n){return e.annotator===t!==(n.annotator===t)?e.annotator===t?-1:1:e.rank!==n.rank?(n.rank||0)-(e.rank||0):e.sentenceIndex-n.sentenceIndex})).map((function(e){return e.sentenceIndex}));return z.a.uniq(r)})))(e),lastArticleId:X(t.articleId,t.category)(e),nextArticleId:F(t.articleId,t.category)(e),annotations:Q(t.articleId,t.category)(e),username:W(e)};var n,a}),(function(e){return{updateAnnotationRank:function(t){e({type:"UPDATE_ANNOTATION_RANK",annotation:t})},addAnnotation:function(t,n,a,r){e(R(t,n,a,r))}}})),Re=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).goToLastArticle=function(){var e=n.props,t=e.category,a=e.history,r=e.lastArticleId;r<0||a.push("/".concat(t,"/").concat(r))},n.goToNextArticle=function(){var e=n.props,t=e.category,a=e.history,r=e.nextArticleId;r<0||a.push("/".concat(t,"/").concat(r))},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.props.lastArticleId<0&&this.props.nextArticleId<0&&ge(this.props.category)}},{key:"onDragEnd",value:function(e){if(e.destination){for(var t=this.props.annotatedSentences[e.source.index],n=this.props.annotatedSentences[e.destination.index],a=null,r=0;r<this.props.annotations.length;r++){var c=this.props.annotations[r];if(t===c.sentenceIndex&&c.annotator===this.props.username){a=r;break}}if(null===a){if(!this.props.username)return;this.props.addAnnotation(this.props.articleId,this.props.category,t,this.props.username)}if(t!==n){var o=null,i=e.destination.index,s=-1;0!==i&&i!==this.props.annotatedSentences.length-1&&(s=e.source.index>i?this.props.annotatedSentences[i-1]:this.props.annotatedSentences[i+1]);for(var l=0,u=0;u<this.props.annotations.length&&l<2;u++){var d=this.props.annotations[u];[n,s].includes(d.sentenceIndex)&&d.annotator===this.props.username&&(o=(o||0)+(d.rank||1)/2,l++)}if(null!==o){if(0===i){if(l<1)return;o=2*o+1024}else if(i===this.props.annotatedSentences.length-1){if(l<1)return}else if(l<2)return;var p={articleId:this.props.articleId,category:this.props.category,sentenceIndex:t,annotator:this.props.username||"",rank:o};this.props.updateAnnotationRank(p),ve.emit("update annotation rank",p)}}}}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"annotator-container"},r.a.createElement(Ne,{articleId:this.props.articleId,category:this.props.category}),r.a.createElement("h3",null,"Select sentences that are relative to the question."),r.a.createElement(je.a,{onDragEnd:this.onDragEnd.bind(this)},r.a.createElement(je.c,{droppableId:"annotation-list"},(function(t){return r.a.createElement("div",Object.assign({},t.droppableProps,{ref:t.innerRef}),(e.props.annotatedSentences||[]).map((function(t,n){return r.a.createElement(je.b,{key:"sentence-card-".concat(t),draggableId:"sentence-".concat(t),index:n},(function(a){return r.a.createElement("div",Object.assign({ref:a.innerRef},a.draggableProps,a.dragHandleProps,{style:Object(T.a)({outline:0},a.draggableProps.style)}),r.a.createElement(Se,{articleId:e.props.articleId,category:e.props.category,sentenceIndex:t,index:n+1}))}))})),t.placeholder)}))),r.a.createElement("div",{className:"last-next-buttons"},r.a.createElement("span",{onClick:this.goToLastArticle,className:"last-article-button",style:this.props.lastArticleId<0?{visibility:"hidden"}:{}},"Last Article"),r.a.createElement("span",{onClick:this.goToNextArticle,className:"next-article-button",style:this.props.nextArticleId<0?{visibility:"hidden"}:{}},"Next Article")))}}]),t}(r.a.Component),De=Object(f.g)(_e(Re)),Le=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).handleClick=function(){var e=n.props,t=e.history,a=e.match.params.category;t.push("/".concat(a))},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(e){if(e.annotators!==this.props.annotators){var t=!0,n=!1,a=void 0;try{for(var r,c=this.props.annotators[Symbol.iterator]();!(t=(r=c.next()).done);t=!0){var o=r.value;pe(o)}}catch(i){n=!0,a=i}finally{try{t||null==c.return||c.return()}finally{if(n)throw a}}}}},{key:"render",value:function(){return r.a.createElement("p",{className:"legends"},r.a.createElement("span",{onClick:this.handleClick},"Go Back"),this.props.annotators.map((function(e){return r.a.createElement("span",{className:ue([e]),key:e},e)})))}}]),t}(r.a.Component),Me=Object(f.g)(Le),we=Object(h.b)((function(e,t){return{sentence:q(t.articleId,t.category,t.sentenceIndex)(e),annotators:(n=t.articleId,a=t.category,r=t.sentenceIndex,Object(L.a)(Z(n,a,r),(function(e){return e.map((function(e){return e.annotator}))})))(e),username:W(e),selectedSentence:ne(e),shouldScrollIntoView:t.plainText?null:ae(e,t.articleId,t.category,t.sentenceIndex,"ARTICLE_SECTION")};var n,a,r}))(function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(c)))).ref=r.a.createRef(),n.handleClick=function(){if(n.props.annotators&&n.props.username&&n.props.dispatch){var e=n.props,t=e.articleId,a=e.category,r=e.sentenceIndex,c=e.username,o="remove annotation";n.props.annotators.includes(n.props.username)?n.props.dispatch(D(t,a,r,c)):(o="add annotation",n.props.dispatch(R(t,a,r,c))),ve.emit(o,{articleId:t,category:a,sentenceIndex:r,annotator:c,rank:0})}},n.handleContextMenu=function(e){e.preventDefault();var t,a,r,c=n.props,o=c.articleId,i=c.category,s=c.sentenceIndex;(n.props.dispatch({type:"CHANGE_SELECTED_TEXT",selectedText:{articleId:-1,category:"",sentenceIndex:-1,selectedIn:"ARTICLE_SECTION"}}),setTimeout((function(){n.props.dispatch({type:"CHANGE_SELECTED_TEXT",selectedText:{articleId:o,category:i,sentenceIndex:s,selectedIn:"ARTICLE_SECTION"}})}),0),0===n.props.annotators.length)&&(null===(t=n.ref.current)||void 0===t||null===(a=t.parentElement)||void 0===a||null===(r=a.parentElement)||void 0===r||r.classList.add("shakey-sentence"),setTimeout((function(){var e,t,a;null===(e=n.ref.current)||void 0===e||null===(t=e.parentElement)||void 0===t||null===(a=t.parentElement)||void 0===a||a.classList.remove("shakey-sentence")}),1e3))},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;setTimeout((function(){if(e.props.plainText&&e.props.annotators.length>0&&e.ref&&e.ref.current){if(null===e.ref.current.parentElement)return;for(var t=e.ref.current.parentElement;!t.classList.contains("article-container");){if(null===t.parentElement)return;t=t.parentElement}t.scrollTo(0,e.ref.current.offsetTop-100)}}),0)}},{key:"componentDidUpdate",value:function(e){var t=this;if(e.shouldScrollIntoView!==this.props.shouldScrollIntoView&&this.props.shouldScrollIntoView){var n;if(!this.ref||!this.ref.current)return;Object(ke.a)(this.ref.current,{behavior:"smooth"}),"HOT_KEY"===(null===(n=this.props.selectedSentence)||void 0===n?void 0:n.selectedIn)||(this.ref.current.classList.add("selected-sentence"),setTimeout((function(){var e;return null===(e=t.ref.current)||void 0===e?void 0:e.classList.remove("selected-sentence")}),1500))}}},{key:"getClassName",value:function(){var e,t=[ue(this.props.annotators||[])];return this.props.shouldScrollIntoView&&"HOT_KEY"===(null===(e=this.props.selectedSentence)||void 0===e?void 0:e.selectedIn)&&t.push("hotkey-selected-sentence"),t.join(" ")}},{key:"render",value:function(){return this.props.plainText?r.a.createElement("span",{ref:this.ref,className:ue(this.props.annotators||[])},this.props.sentence,pe(this.props.annotators||[])):r.a.createElement("span",{ref:this.ref,onClick:this.handleClick,onContextMenu:this.handleContextMenu,className:this.getClassName()},this.props.sentence,pe(this.props.annotators||[]))}}]),t}(r.a.Component)),Ue=Object(h.b)((function(e,t){return{article:K(t.articleId,t.category)(e),annotators:(n=t.articleId,a=t.category,Object(L.a)(Q(n,a),W,(function(e,t){var n=e.map((function(e){return e.annotator})).filter((function(e){return e!==t}));return n.push(t||""),z.a.uniq(n)})))(e)};var n,a}),(function(e){return{addAnnotation:function(t,n,a,r){e(R(t.id,t.category,n,a,r))},addArticle:function(t){e({type:"ADD_ARTICLE",article:t})},updateParagraphToSentencesMap:function(t,n,a){e({type:"UPDATE_PARAGRAPH_TO_SENTENCES",article:t,paragraphIndex:n,sentences:a})}}}))(function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).getArticle=function(){ve.emit("get article",{articleId:n.props.articleId,category:n.props.category},(function(e){n.props.addArticle(e);var t=!0,a=!1,r=void 0;try{for(var c,o=(e.annotations||[])[Symbol.iterator]();!(t=(c=o.next()).done);t=!0){var i=c.value;n.props.addAnnotation(e,i.sentenceIndex,i.annotator,i.rank)}}catch(s){a=!0,r=s}finally{try{t||null==o.return||o.return()}finally{if(a)throw r}}}))},n.blockContextMenu=function(e){return e.preventDefault()},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.getArticle()}},{key:"componentDidUpdate",value:function(e){e.articleId===this.props.articleId&&e.category===this.props.category||this.getArticle()}},{key:"componentWillUnmount",value:function(){ve.emit("leave article",{articleId:this.props.articleId,category:this.props.category})}},{key:"getParagraph",value:function(e,t){if(this.props.article){var n=[],a=this.props,c=a.article,o=a.articleId,i=a.category,s=a.displayOnly;if(this.props.article.paragraphToSentences&&this.props.article.paragraphToSentences[t])n=this.props.article.paragraphToSentences[t];else{for(var l=e.trim(),u=-1,d=-1,p=0;p<this.props.article.sentences.length;p++)if(l.startsWith(this.props.article.sentences[p])){if(-1===u&&(u=p),0===(l=l.slice(this.props.article.sentences[p].length).trim()).length){d=p;break}}else u=-1,l=e.trim();for(var h=u;h<=d;h++)n.push(h);this.props.updateParagraphToSentencesMap(c,t,n)}return r.a.createElement("p",{key:"paragraph-".concat(t)},n.map((function(e){return r.a.createElement("span",{key:"sentence-".concat(e)},r.a.createElement(we,{articleId:o,category:i,sentenceIndex:e,plainText:s})," ")})))}}},{key:"render",value:function(){var e=this;return this.props.article?this.props.displayOnly?r.a.createElement("div",{className:"article-container not-so-smooth"},this.props.article.paragraphs.map((function(t,n){return e.getParagraph(t,n)}))):r.a.createElement("div",{className:"article-container",onContextMenu:this.blockContextMenu},r.a.createElement(Me,{articleId:"1",annotators:this.props.annotators}),this.props.article.paragraphs.map((function(t,n){return e.getParagraph(t,n)}))):r.a.createElement("div",{className:"article-container"})}}]),t}(r.a.Component)),Pe=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).handleClick=function(){n.props.history.push("/".concat(n.props.category,"/").concat(n.props.articleId))},n.state={hasRenderedInFull:!n.props.shouldNotRenderInFull},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(e){this.state.hasRenderedInFull||e.shouldNotRenderInFull||this.setState({hasRenderedInFull:!0})}},{key:"render",value:function(){return this.props.shouldNotRenderInFull&&!this.state.hasRenderedInFull?r.a.createElement("div",{className:"article-card-container",style:this.props.style},r.a.createElement("div",{className:"article-container",style:{backgroundColor:"#fff"}}),r.a.createElement("span",null,"Article ",this.props.articleId)):r.a.createElement("div",{onClick:this.handleClick,className:"article-card-container",style:this.props.style},r.a.createElement(Ue,Object.assign({},this.props,{displayOnly:!0})),r.a.createElement("div",{className:"article-container-mask"}),r.a.createElement("span",null,"Article ",this.props.articleId))}}]),t}(r.a.Component),He=Object(f.g)(Pe),Ve=n(97),Ge=Object(h.b)((function(e,t){return{articleIds:G(t.match.params.category)(e),category:t.match.params.category}})),Xe=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(c)))).getArticleCard=function(e){var t=e.columnIndex,a=e.rowIndex,c=e.style,o=e.key,i=e.isScrolling,s=e.parent,l=e.isVisible,u=t+a*Math.floor(s.props.width/240);if(u>=n.props.articleIds.length)return r.a.createElement("div",{style:c,key:o});var d=n.props.articleIds[u];return r.a.createElement("div",{key:o,style:Object(T.a)({},c,{display:"flex",justifyContent:"center"})},r.a.createElement(He,{category:n.props.category,articleId:d,shouldNotRenderInFull:i&&!l,style:{width:"12rem"}}))},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){ge(this.props.category)}},{key:"render",value:function(){var e=this;return r.a.createElement(Ve.a,null,(function(t){var n=t.height,a=t.width,c=Math.floor(a/240);return r.a.createElement(Ve.b,{className:"article-card-panel-container",cellRenderer:e.getArticleCard.bind(e),width:a,height:n,columnWidth:(a-32)/c,columnCount:c,rowHeight:360,rowCount:Math.ceil((e.props.articleIds||[]).length/c)})}))}}]),t}(r.a.Component),Fe=Object(f.g)(Ge(Xe)),Ke=n(53),qe=Object(h.b)(null,(function(e){return{setUsername:function(t){e({type:"CHANGE_USERNAME",username:t})}}}))(function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={username:""},n.handleChange=n.handleChange.bind(Object(Ke.a)(n)),n.changeUsername=n.changeUsername.bind(Object(Ke.a)(n)),n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"handleChange",value:function(e){this.setState({username:e.target.value})}},{key:"changeUsername",value:function(){this.props.setUsername&&this.props.setUsername(this.state.username)}},{key:"render",value:function(){return r.a.createElement("div",{className:"username-container"},r.a.createElement("input",{placeholder:"Username",className:"username-input",onChange:this.handleChange}),r.a.createElement("span",{className:"username-button",onClick:this.changeUsername},"Set Username"))}}]),t}(r.a.Component)),We=Object(h.b)((function(e){return{isUserLoggedIn:Y(e)}})),Ye=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return this.props.isUserLoggedIn?r.a.createElement(f.d,null,r.a.createElement(f.b,{path:"/:category/:articleId",component:Te}),r.a.createElement(f.b,{path:"/:category",component:Fe}),r.a.createElement(f.b,{path:"/"},r.a.createElement(f.a,{to:"/Question 1 test"}))):r.a.createElement(qe,null)}}]),t}(r.a.Component),Be=Object(f.g)(We(Ye));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(h.a,{store:oe},r.a.createElement(i.a,{basename:"article-annotator"},r.a.createElement(Be,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[139,1,2]]]);
//# sourceMappingURL=main.c81d4f6f.chunk.js.map