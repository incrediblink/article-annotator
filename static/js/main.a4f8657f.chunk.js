(this.webpackJsonpannotator=this.webpackJsonpannotator||[]).push([[0],{141:function(e,t,n){e.exports=n(246)},146:function(e,t,n){},181:function(e,t){},246:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(24),c=n.n(o),i=n(28),s=(n(146),n(11)),l=n(12),u=n(14),d=n(13),p=n(15),h=n(9),f=n(36),m=n(25),g=n(133),v=n(66),y=n.n(v);var I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;return"CHANGE_USERNAME"===t.type?(y.a.set("username",t.username),t.username):e},b=n(18);function O(e,t){return e.articleId===t.articleId&&e.sentenceIndex===t.sentenceIndex&&e.annotator===t.annotator&&e.category===t.category}var E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_ANNOTATION":for(var n=0;n<e.length;n++)if(O(t.annotation,e[n]))return e;return[].concat(Object(b.a)(e),[t.annotation]);case"REMOVE_ANNOTATION":for(var r=0;r<e.length;r++)if(O(t.annotation,e[r]))return[].concat(Object(b.a)(e.slice(0,r)),Object(b.a)(e.slice(r+1)));break;case"UPDATE_ANNOTATION_RANK":for(var a=t.annotation,o=0;o<e.length;o++)if(O(a,e[o]))return[].concat(Object(b.a)(e.slice(0,o)),[a],Object(b.a)(e.slice(o+1)))}return e},A=n(47),T=n(10),j={loadedArticles:[],categoryToArticleIdListMap:{}};var C=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"ADD_ARTICLE":e=n.article;for(var r=0;r<t.loadedArticles.length;r++)if(t.loadedArticles[r].id===e.id&&t.loadedArticles[r].category===e.category)return Object(T.a)({},t,{loadedArticles:[].concat(Object(b.a)(t.loadedArticles.slice(0,r)),[e],Object(b.a)(t.loadedArticles.slice(r+1)))});return Object(T.a)({},t,{loadedArticles:[].concat(Object(b.a)(t.loadedArticles),[e])});case"REMOVE_ARTICLE":e=n.article;for(var a=0;a<t.loadedArticles.length;a++)if(t.loadedArticles[a]===e)return Object(T.a)({},t,{loadedArticles:[].concat(Object(b.a)(t.loadedArticles.slice(0,a)),Object(b.a)(t.loadedArticles.slice(a+1)))});break;case"UPDATE_CATEGORY_ARTICLE_LIST":var o=n,c=o.category,i=o.articleIds;return Object(T.a)({},t,{categoryToArticleIdListMap:Object(T.a)({},t.categoryToArticleIdListMap,Object(A.a)({},c,i))});case"UPDATE_PARAGRAPH_TO_SENTENCES":e=n.article;for(var s=n,l=s.paragraphIndex,u=s.sentences,d=0;d<t.loadedArticles.length;d++){var p=t.loadedArticles[d];if(p.id===e.id&&p.category===e.category)return(p=Object(T.a)({},p)).paragraphToSentences=p.paragraphToSentences||[],p.paragraphToSentences[l]=u,Object(T.a)({},t,{loadedArticles:[].concat(Object(b.a)(t.loadedArticles.slice(0,d)),[p],Object(b.a)(t.loadedArticles.slice(d+1)))})}}return t},x={annotatorToColorMap:{},annotatorToAnnotatorsMap:{},existingCombinations:[]};var N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CHANGE_COLOR":var n=t.username,r=t.color;return Object(T.a)({},e,{annotatorToColorMap:Object(T.a)({},e.annotatorToColorMap,Object(A.a)({},n,r))});case"ADD_COLORS_TO_DOCUMENT":if(!e.existingCombinations.includes(t.className))return Object(T.a)({},e,{existingCombinations:[].concat(Object(b.a)(e.existingCombinations),[t.className])})}return e};var k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{categories:[]},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CHANGE_SELECTED_TEXT":return Object(T.a)({},e,{selectedSentence:t.selectedText});case"SET_CURRENT_ARTICLE":var n=t,r=n.articleId,a=n.category;return Object(T.a)({},e,{currentArticle:{articleId:r,category:a}});case"DISPLAY_OTHERS_ANNOTATION":return Object(T.a)({},e,{displayOthersAnnotation:!e.displayOthersAnnotation});case"SET_CATEGORY_LIST":var o=t;return Object(T.a)({},e,{categories:o.categories})}return e},S=["rgb(169, 222, 204)","rgb(255, 227, 134)","rgb(214, 157, 177)","rgba(0, 181, 204, 1)","rgb(226, 106, 106)","rgb(190, 144, 212)","rgb(141, 195, 234)","rgb(215, 186, 229)","rgb(140, 20, 252)","rgb(241, 169, 160)","rgb(145, 61, 136)","rgb(118, 93, 105)","rgb(154, 18, 179)"];function _(e,t){return{type:"SET_CURRENT_ARTICLE",articleId:e,category:t}}function R(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return{type:"ADD_ANNOTATION",annotation:{articleId:e,category:t,sentenceIndex:n,annotator:r,rank:a}}}function D(e,t,n,r){return{type:"REMOVE_ANNOTATION",annotation:{articleId:e,category:t,sentenceIndex:n,annotator:r}}}var L=n(16),w=function(e){return e.colors},M=Object(L.a)(w,(function(e){return e.annotatorToColorMap})),U=Object(L.a)(w,(function(e){return e.existingCombinations})),P=function(e){return e.articles},H=Object(L.a)(P,(function(e){return e.categoryToArticleIdListMap})),V=Object(L.a)(P,(function(e){return e.loadedArticles})),G=function(e){return Object(L.a)(H,(function(t){return t[e]}))},Y=function(e,t){return Object(L.a)(G(t),(function(t){if(!t)return-1;var n=t.indexOf(e);return n<=0?-1:t[n-1]}))},K=function(e,t){return Object(L.a)(G(t),(function(t){if(!t)return-1;var n=t.indexOf(e);return n<0||n+1===t.length?-1:t[n+1]}))},X=function(e,t){return Object(L.a)(V,(function(n){var r=!0,a=!1,o=void 0;try{for(var c,i=n[Symbol.iterator]();!(r=(c=i.next()).done);r=!0){var s=c.value;if(s.id===e&&s.category===t)return s}}catch(l){a=!0,o=l}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}}))},F=function(e,t,n){return Object(L.a)(X(e,t),(function(e){if(void 0!==e)return e.sentences[n]}))},q=function(e){return e.username},W=Object(L.a)(q,(function(e){return void 0!==e&&e.length>0})),B=n(32),z=n.n(B),J=function(e){return e.annotations},Z=function(e,t){return Object(L.a)(J,(function(e){return e.utils.displayOthersAnnotation}),q,(function(n,r,a){return n.filter((function(n){return n.articleId===e&&n.category===t&&(r||n.annotator===a)}))}))},$=function(e,t,n){return Object(L.a)(Z(e,t),(function(e){return e.filter((function(e){return e.sentenceIndex===n}))}))},Q=function(e,t,n){return Object(L.a)(q,$(e,t,n),(function(e,t){var n=!0,r=!1,a=void 0;try{for(var o,c=t[Symbol.iterator]();!(n=(o=c.next()).done);n=!0){if(o.value.annotator===e)return!0}}catch(i){r=!0,a=i}finally{try{n||null==c.return||c.return()}finally{if(r)throw a}}return!1}))},ee=function(e){return e.utils},te=function(e){return ee(e).currentArticle},ne=function(e){return ee(e).selectedSentence},re=function(e,t,n,r,a){var o=ee(e);if(!o.selectedSentence)return!1;var c=o.selectedSentence;return"DESELECT"!==c.selectedIn&&(c.articleId===t&&c.sentenceIndex===r&&c.category===n&&a!==c.selectedIn)},ae={username:y.a.get("username"),colors:{annotatorToColorMap:{},annotatorToAnnotatorsMap:{},existingCombinations:[]},articles:{categoryToArticleIdListMap:{},loadedArticles:[]},annotations:[],utils:{categories:[]}},oe=Object(m.c)({username:I,annotations:E,articles:C,colors:N,utils:k}),ce=Object(m.e)(oe,ae,Object(m.a)(g.a)),ie=n(134);var se=function(e,t){if(0!==t.length){var n=document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",r.innerHTML=".".concat(e," {").concat(t,"}"),n.appendChild(r)}};function le(e){for(var t="",n=0;n<e.length;n++)if(e[n]>="a"&&e[n]<="z")t+=e[n];else if(e[n]>="A"&&e[n]<="Z")t+=e[n];else{for(var r=encodeURIComponent(e[n]);r.indexOf("%")>=0;)r=r.replace("%","---");t+=r}return t}var ue=function(e){return z.a.isString(e)&&(e=[e]),0===e.length?"":(e=z.a.uniq(e).sort(),"highlight-".concat(e.map(le).join("-")))};var de=function(e,t){if(z.a.isString(t)&&(t=[t]),0===t.length)return"";t=z.a.uniq(t).sort();var n=!0,r=!1,a=void 0;try{for(var o,c=t[Symbol.iterator]();!(n=(o=c.next()).done);n=!0){var i=o.value;if(!e[i]){var s=void 0,l=!0,u=!1,d=void 0;try{for(var p,h=S[Symbol.iterator]();!(l=(p=h.next()).done);l=!0){var f=p.value,m=!1;for(var g in e)if(e[g]===f){m=!0;break}if(!m){s=f;break}}}catch(E){u=!0,d=E}finally{try{l||null==h.return||h.return()}finally{if(u)throw d}}s||(s=S[Math.floor(Math.random()*S.length)]),ce.dispatch({type:"CHANGE_COLOR",username:i,color:s}),e[i]=s}}}catch(E){r=!0,a=E}finally{try{n||null==c.return||c.return()}finally{if(r)throw a}}var v="background-image: linear-gradient(";if(1===t.length){var y=e[t[0]];return v+="transparent 0px, transparent 50%, ".concat(y," 0px, ").concat(y,");")}for(var I=0;I<t.length;I++){var b=t[I],O=e[b];v+="".concat(O," 0px, ").concat(O," ").concat(100*(I+1)/t.length,"%"),t.indexOf(b)!==t.length-1?v+=",":v+=");"}return v};var pe=function(e){var t=ue(e);if(!function(e){return Object(L.a)(U,(function(t){return t.includes(e)}))}(t)(ce.getState())){var n=de(M(ce.getState()),e);se(t,n),ce.dispatch(function(e){return{type:"ADD_COLORS_TO_DOCUMENT",className:e}}(t))}},he=n(135),fe=n.n(he)()("https://backend.annotator.zehua.li/"),me=function(e){fe.emit("refresh article list",{category:e},(function(t){ce.dispatch({type:"UPDATE_CATEGORY_ARTICLE_LIST",category:e,articleIds:t})}))};fe.on("add annotation",(function(e){var t=e.articleId,n=e.category,r=e.annotator,a=e.sentenceIndex;ce.dispatch(R(t,n,a,r))})),fe.on("remove annotation",(function(e){var t=e.articleId,n=e.category,r=e.annotator,a=e.sentenceIndex;ce.dispatch(D(t,n,a,r))})),fe.on("update annotation rank",(function(e){ce.dispatch({type:"UPDATE_ANNOTATION_RANK",annotation:e})}));var ge=fe,ve=function(e){var t=te(ce.getState());if(t){var n=X(t.articleId,t.category)(ce.getState());if(n){var r=n.sentences,a=ne(ce.getState());(!a||a.articleId!==t.articleId||a.articleId<0)&&(a=Object(T.a)({},t,{sentenceIndex:-e,selectedIn:"HOT_KEY"})),a.sentenceIndex+=e,a.sentenceIndex=Math.min(r.length-1,a.sentenceIndex),a.sentenceIndex=Math.max(0,a.sentenceIndex),a.selectedIn="HOT_KEY",ye(),ce.dispatch({type:"CHANGE_SELECTED_TEXT",selectedText:a})}}},ye=function(){var e=ne(ce.getState());if(e)return ce.dispatch({type:"CHANGE_SELECTED_TEXT",selectedText:Object(T.a)({},e,{selectedIn:"DESELECT"})});ce.dispatch({type:"CHANGE_SELECTED_TEXT",selectedText:{articleId:-1,category:"",sentenceIndex:-1,selectedIn:"DESELECT"}})},Ie=function(e){var t=te(ce.getState());if(t){var n=G(t.category)(ce.getState()),r=n.indexOf(t.articleId)+e;r=Math.min(n.length-1,r),r=Math.max(0,r),ce.dispatch(_(n[r],t.category)),window.history.pushState(null,"","/article-annotator/".concat(t.category,"/").concat(n[r]))}},be={ENTER:["enter","k"],MOVE_UP:["w","h"],MOVE_DOWN:["s","j"],DESELECT:["q","l"],LAST_ARTICLE:["[","y"],NEXT_ARTICLE:["]","u"]},Oe={ENTER:function(){var e=ne(ce.getState());if(e&&!(e.articleId<0)){var t=q(ce.getState());if(t){var n=e.articleId,r=e.category,a=e.sentenceIndex,o=Q(n,r,a)(ce.getState());o?ce.dispatch(D(n,r,a,t)):ce.dispatch(R(n,r,a,t)),ge.emit("".concat(o?"remove":"add"," annotation"),Object(T.a)({},e,{annotator:t,rank:0}))}}},MOVE_UP:function(){return ve(-1)},MOVE_DOWN:function(){return ve(1)},DESELECT:ye,LAST_ARTICLE:function(){return Ie(-1)},NEXT_ARTICLE:function(){return Ie(1)}},Ee=Object(h.b)((function(e){var t,n;return{articleId:null===(t=te(e))||void 0===t?void 0:t.articleId,category:null===(n=te(e))||void 0===n?void 0:n.category,isUserLoggedIn:W(e)}}),(function(e){return{setCurrentArticle:function(t,n){e(_(t,n))}}})),Ae=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.onRouteChanged()}},{key:"componentDidUpdate",value:function(e){this.props.location!==e.location&&this.onRouteChanged()}},{key:"onRouteChanged",value:function(){this.leaveArticle();var e=this.props.match,t=+e.params.articleId,n=e.params.category;this.props.setCurrentArticle(t,n),ge.emit("join article",{articleId:t,category:n}),window.scrollTo(0,0)}},{key:"leaveArticle",value:function(){if(this.props.articleId&&this.props.category){var e=this.props,t=e.articleId,n=e.category;ge.emit("leave article",{articleId:t,category:n})}}},{key:"render",value:function(){if(!this.props.articleId||!this.props.category)return a.a.createElement("div",{className:"annotation-panel-container"});var e=this.props,t=e.articleId,n=e.category;return a.a.createElement("div",{className:"annotation-panel-container"},a.a.createElement(Ve,{articleId:t,category:n}),a.a.createElement(De,{articleId:t,category:n}),a.a.createElement(ie.GlobalHotKeys,{keyMap:be,handlers:Oe}))}}]),t}(a.a.Component),Te=Object(f.f)(Ee(Ae)),je=n(70),Ce=function(e,t){return{article:X(t.articleId,t.category)(e)}},xe=(Object(h.b)(Ce),function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){if(!this.props.article)return a.a.createElement("div",null);var e=this.props.article,t=e.question,n=e.explanation;return a.a.createElement("p",{className:"explanation"},a.a.createElement("b",null,a.a.createElement("i",null,t)),a.a.createElement("br",null),n)}}]),t}(a.a.Component)),Ne=Object(h.b)(Ce)(xe),ke=n(69),Se=Object(h.b)((function(e,t){return{sentence:F(t.articleId,t.category,t.sentenceIndex)(e),checked:Q(t.articleId,t.category,t.sentenceIndex)(e),username:q(e),shouldScrollIntoView:re(e,t.articleId,t.category,t.sentenceIndex,"ANNOTATION_SECTION")}}),(function(e){return{addAnnotation:function(t,n,r,a){e({type:"ADD_ANNOTATION",annotation:{articleId:t,category:n,sentenceIndex:r,annotator:a}})},removeAnnotation:function(t,n,r,a){e({type:"REMOVE_ANNOTATION",annotation:{articleId:t,category:n,sentenceIndex:r,annotator:a}})},changeSelectedText:function(t,n,r){e({type:"CHANGE_SELECTED_TEXT",selectedText:{articleId:t,category:n,sentenceIndex:r,selectedIn:"ANNOTATION_SECTION"}})}}}))(function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return(n=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).divRef=a.a.createRef(),n.handleClick=function(){if(n.props.username){var e=n.props,t=e.articleId,r=e.category,a=e.sentenceIndex,o=e.username;n.props.checked?n.props.removeAnnotation(t,r,a,o):n.props.addAnnotation(t,r,a,o),ge.emit(n.props.checked?"remove annotation":"add annotation",{articleId:t,category:r,sentenceIndex:a,annotator:o})}},n.handleContextMenu=function(e){e.preventDefault();var t=n.props,r=t.articleId,a=t.category,o=t.sentenceIndex;n.props.changeSelectedText(-1,"",-1),setTimeout((function(){return n.props.changeSelectedText(r,a,o)}),0)},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this;if(e.shouldScrollIntoView!==this.props.shouldScrollIntoView&&this.props.shouldScrollIntoView){if(!this.divRef||!this.divRef.current)return;Object(ke.a)(this.divRef.current,{behavior:"smooth"}),this.divRef.current.classList.add("selected-sentence-card"),setTimeout((function(){var e;return null===(e=t.divRef.current)||void 0===e?void 0:e.classList.remove("selected-sentence-card")}),1500)}}},{key:"render",value:function(){return a.a.createElement("div",{ref:this.divRef,onClick:this.handleClick,onContextMenu:this.handleContextMenu,className:"sentence-card ".concat(this.props.checked?"checked":"")},a.a.createElement("p",null,this.props.sentence),a.a.createElement("div",{className:"side"},a.a.createElement("span",null,this.props.index)),a.a.createElement("div",{className:"sentence-card-background"}))}}]),t}(a.a.Component)),_e=Object(h.b)((function(e,t){return{annotatedSentences:(n=t.articleId,r=t.category,Object(L.a)(Z(n,r),q,(function(e,t){var a=e.filter((function(e){return e.articleId===n&&e.category===r})).sort((function(e,n){return e.annotator===t!==(n.annotator===t)?e.annotator===t?-1:1:e.rank!==n.rank?(n.rank||0)-(e.rank||0):e.sentenceIndex-n.sentenceIndex})).map((function(e){return e.sentenceIndex}));return z.a.uniq(a)})))(e),lastArticleId:Y(t.articleId,t.category)(e),nextArticleId:K(t.articleId,t.category)(e),annotations:Z(t.articleId,t.category)(e),username:q(e)};var n,r}),(function(e){return{updateAnnotationRank:function(t){e({type:"UPDATE_ANNOTATION_RANK",annotation:t})},addAnnotation:function(t,n,r,a){e(R(t,n,r,a))}}})),Re=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return(n=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).ref=a.a.createRef(),n.goToLastArticle=function(){var e=n.props,t=e.category,r=e.history,a=e.lastArticleId;a<0||r.push("/".concat(t,"/").concat(a))},n.goToNextArticle=function(){var e=n.props,t=e.category,r=e.history,a=e.nextArticleId;a<0||r.push("/".concat(t,"/").concat(a))},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.props.lastArticleId<0&&this.props.nextArticleId<0&&me(this.props.category)}},{key:"componentDidUpdate",value:function(e){e.articleId===this.props.articleId&&e.category===this.props.category||this.ref&&this.ref.current&&this.ref.current.scrollTo(0,0)}},{key:"onDragEnd",value:function(e){if(e.destination){for(var t=this.props.annotatedSentences[e.source.index],n=this.props.annotatedSentences[e.destination.index],r=null,a=0;a<this.props.annotations.length;a++){var o=this.props.annotations[a];if(t===o.sentenceIndex&&o.annotator===this.props.username){r=a;break}}if(null===r){if(!this.props.username)return;this.props.addAnnotation(this.props.articleId,this.props.category,t,this.props.username)}if(t!==n){var c=null,i=e.destination.index,s=-1;0!==i&&i!==this.props.annotatedSentences.length-1&&(s=e.source.index>i?this.props.annotatedSentences[i-1]:this.props.annotatedSentences[i+1]);for(var l=0,u=0;u<this.props.annotations.length&&l<2;u++){var d=this.props.annotations[u];[n,s].includes(d.sentenceIndex)&&d.annotator===this.props.username&&(c=(c||0)+(d.rank||1)/2,l++)}if(null!==c){if(0===i){if(l<1)return;c=2*c+1024}else if(i===this.props.annotatedSentences.length-1){if(l<1)return}else if(l<2)return;var p={articleId:this.props.articleId,category:this.props.category,sentenceIndex:t,annotator:this.props.username||"",rank:c};this.props.updateAnnotationRank(p),ge.emit("update annotation rank",p)}}}}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"annotator-container",ref:this.ref},a.a.createElement(Ne,{articleId:this.props.articleId,category:this.props.category}),a.a.createElement("h3",null,"Select sentences that are relative to the question."),a.a.createElement(je.a,{onDragEnd:this.onDragEnd.bind(this)},a.a.createElement(je.c,{droppableId:"annotation-list"},(function(t){return a.a.createElement("div",Object.assign({},t.droppableProps,{ref:t.innerRef}),(e.props.annotatedSentences||[]).map((function(t,n){return a.a.createElement(je.b,{key:"sentence-card-".concat(t),draggableId:"sentence-".concat(t),index:n},(function(r){return a.a.createElement("div",Object.assign({ref:r.innerRef},r.draggableProps,r.dragHandleProps,{style:Object(T.a)({outline:0},r.draggableProps.style)}),a.a.createElement(Se,{articleId:e.props.articleId,category:e.props.category,sentenceIndex:t,index:n+1}))}))})),t.placeholder)}))),a.a.createElement("div",{className:"last-next-buttons"},a.a.createElement("span",{onClick:this.goToLastArticle,className:"last-article-button",style:this.props.lastArticleId<0?{visibility:"hidden"}:{}},"Last Article"),a.a.createElement("span",{onClick:this.goToNextArticle,className:"next-article-button",style:this.props.nextArticleId<0?{visibility:"hidden"}:{}},"Next Article")))}}]),t}(a.a.Component),De=Object(f.f)(_e(Re)),Le=n(55),we=n.n(Le),Me=n(98),Ue=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).handleClick=function(){var e=n.props,t=e.history,r=e.match.params.category;t.push("/".concat(r))},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(e){if(e.annotators!==this.props.annotators){var t=!0,n=!1,r=void 0;try{for(var a,o=this.props.annotators[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var c=a.value;pe(c)}}catch(i){n=!0,r=i}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}}}},{key:"render",value:function(){return a.a.createElement("p",{className:"legends"},a.a.createElement("span",{onClick:this.handleClick},"Go Back"),this.props.annotators.map((function(e){return a.a.createElement("span",{className:ue([e]),key:e},e)})))}}]),t}(a.a.Component),Pe=Object(f.f)(Ue),He=Object(h.b)((function(e,t){return{sentence:F(t.articleId,t.category,t.sentenceIndex)(e),annotators:(n=t.articleId,r=t.category,a=t.sentenceIndex,Object(L.a)($(n,r,a),(function(e){return e.map((function(e){return e.annotator}))})))(e),username:q(e),selectedSentence:ne(e),shouldScrollIntoView:t.plainText?null:re(e,t.articleId,t.category,t.sentenceIndex,"ARTICLE_SECTION")};var n,r,a}))(function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return(n=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).ref=a.a.createRef(),n.handleClick=function(){if(n.props.annotators&&n.props.username&&n.props.dispatch){var e=n.props,t=e.articleId,r=e.category,a=e.sentenceIndex,o=e.username,c="remove annotation";n.props.annotators.includes(n.props.username)?n.props.dispatch(D(t,r,a,o)):(c="add annotation",n.props.dispatch(R(t,r,a,o))),ge.emit(c,{articleId:t,category:r,sentenceIndex:a,annotator:o,rank:0})}},n.handleContextMenu=function(e){e.preventDefault();var t,r,a,o=n.props,c=o.articleId,i=o.category,s=o.sentenceIndex;(n.props.dispatch({type:"CHANGE_SELECTED_TEXT",selectedText:{articleId:-1,category:"",sentenceIndex:-1,selectedIn:"ARTICLE_SECTION"}}),setTimeout((function(){n.props.dispatch({type:"CHANGE_SELECTED_TEXT",selectedText:{articleId:c,category:i,sentenceIndex:s,selectedIn:"ARTICLE_SECTION"}})}),0),0===n.props.annotators.length)&&(null===(t=n.ref.current)||void 0===t||null===(r=t.parentElement)||void 0===r||null===(a=r.parentElement)||void 0===a||a.classList.add("shakey-sentence"),setTimeout((function(){var e,t,r;null===(e=n.ref.current)||void 0===e||null===(t=e.parentElement)||void 0===t||null===(r=t.parentElement)||void 0===r||r.classList.remove("shakey-sentence")}),1e3))},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.scrollToSentenceInPlainView()}},{key:"componentDidUpdate",value:function(e){var t=this;if(this.scrollToSentenceInPlainView(),e.shouldScrollIntoView!==this.props.shouldScrollIntoView&&this.props.shouldScrollIntoView){var n;if(!this.ref||!this.ref.current)return;Object(ke.a)(this.ref.current,{behavior:"smooth"}),"HOT_KEY"===(null===(n=this.props.selectedSentence)||void 0===n?void 0:n.selectedIn)||(this.ref.current.classList.add("selected-sentence"),setTimeout((function(){var e;return null===(e=t.ref.current)||void 0===e?void 0:e.classList.remove("selected-sentence")}),1500))}}},{key:"scrollToSentenceInPlainView",value:function(){var e=this;setTimeout((function(){if(e.props.plainText&&e.props.annotators.length>0&&e.ref&&e.ref.current){if(null===e.ref.current.parentElement)return;for(var t=e.ref.current.parentElement;!t.classList.contains("article-container");){if(null===t.parentElement)return;t=t.parentElement}t.scrollTo(0,e.ref.current.offsetTop-100)}}),0)}},{key:"getClassName",value:function(){var e,t=[ue(this.props.annotators||[])];return this.props.shouldScrollIntoView&&"HOT_KEY"===(null===(e=this.props.selectedSentence)||void 0===e?void 0:e.selectedIn)&&t.push("hotkey-selected-sentence"),t.join(" ")}},{key:"render",value:function(){return this.props.plainText?a.a.createElement("span",{ref:this.ref,className:ue(this.props.annotators||[])},this.props.sentence,pe(this.props.annotators||[])):a.a.createElement("span",{ref:this.ref,onClick:this.handleClick,onContextMenu:this.handleContextMenu,className:this.getClassName()},this.props.sentence,pe(this.props.annotators||[]))}}]),t}(a.a.Component)),Ve=Object(h.b)((function(e,t){return{article:X(t.articleId,t.category)(e),annotators:(n=t.articleId,r=t.category,Object(L.a)(Z(n,r),q,(function(e,t){var n=e.map((function(e){return e.annotator})).filter((function(e){return e!==t}));return n.push(t||""),z.a.uniq(n)})))(e)};var n,r}),(function(e){return{addAnnotation:function(t,n,r,a){e(R(t.id,t.category,n,r,a))},addArticle:function(t){e({type:"ADD_ARTICLE",article:t})},updateParagraphToSentencesMap:function(t,n,r){e({type:"UPDATE_PARAGRAPH_TO_SENTENCES",article:t,paragraphIndex:n,sentences:r})}}}))(function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return(n=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).ref=a.a.createRef(),n.getArticle=Object(Me.a)(we.a.mark((function e(){return we.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){ge.emit("get article",{articleId:n.props.articleId,category:n.props.category},(function(t){n.props.addArticle(t);var r=!0,a=!1,o=void 0;try{for(var c,i=(t.annotations||[])[Symbol.iterator]();!(r=(c=i.next()).done);r=!0){var s=c.value;n.props.addAnnotation(t,s.sentenceIndex,s.annotator,s.rank)}}catch(l){a=!0,o=l}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}e()}))})));case 1:case"end":return e.stop()}}),e)}))),n.blockContextMenu=function(e){return e.preventDefault()},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.getArticle()}},{key:"componentDidUpdate",value:function(){var e=Object(Me.a)(we.a.mark((function e(t){return we.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.articleId===this.props.articleId&&t.category===this.props.category){e.next=4;break}return e.next=3,this.getArticle();case 3:this.ref&&this.ref.current&&this.ref.current.scrollTo(0,0);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){ge.emit("leave article",{articleId:this.props.articleId,category:this.props.category})}},{key:"getParagraph",value:function(e,t){if(this.props.article){var n=[],r=this.props,o=r.article,c=r.articleId,i=r.category,s=r.displayOnly;if(this.props.article.paragraphToSentences&&this.props.article.paragraphToSentences[t])n=this.props.article.paragraphToSentences[t];else{for(var l=e.trim(),u=-1,d=-1,p=0;p<this.props.article.sentences.length;p++)if(l.startsWith(this.props.article.sentences[p])){if(-1===u&&(u=p),0===(l=l.slice(this.props.article.sentences[p].length).trim()).length){d=p;break}}else u=-1,l=e.trim();for(var h=u;h<=d;h++)n.push(h);this.props.updateParagraphToSentencesMap(o,t,n)}return a.a.createElement("p",{key:"paragraph-".concat(t)},n.map((function(e){return a.a.createElement("span",{key:"sentence-".concat(e)},a.a.createElement(He,{articleId:c,category:i,sentenceIndex:e,plainText:s})," ")})))}}},{key:"render",value:function(){var e=this;return this.props.article?this.props.displayOnly?a.a.createElement("div",{className:"article-container not-so-smooth"},this.props.article.paragraphs.map((function(t,n){return e.getParagraph(t,n)}))):a.a.createElement("div",{className:"article-container",onContextMenu:this.blockContextMenu,ref:this.ref},a.a.createElement(Pe,{articleId:"1",annotators:this.props.annotators}),this.props.article.paragraphs.map((function(t,n){return e.getParagraph(t,n)}))):a.a.createElement("div",{className:"article-container"})}}]),t}(a.a.Component)),Ge=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).handleClick=function(){n.props.history.push("/".concat(n.props.category,"/").concat(n.props.articleId))},n.state={hasRenderedInFull:!n.props.shouldNotRenderInFull},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(e){this.state.hasRenderedInFull||e.shouldNotRenderInFull||this.setState({hasRenderedInFull:!0})}},{key:"render",value:function(){return this.props.shouldNotRenderInFull&&!this.state.hasRenderedInFull?a.a.createElement("div",{className:"article-card-container",style:this.props.style},a.a.createElement("div",{className:"article-container",style:{backgroundColor:"#fff"}}),a.a.createElement("span",null,"Article ",this.props.articleId)):a.a.createElement("div",{onClick:this.handleClick,className:"article-card-container",style:this.props.style},a.a.createElement(Ve,Object.assign({},this.props,{displayOnly:!0})),a.a.createElement("div",{className:"article-container-mask"}),a.a.createElement("span",null,"Article ",this.props.articleId))}}]),t}(a.a.Component),Ye=Object(f.f)(Ge),Ke=n(99),Xe=Object(h.b)((function(e,t){return{articleIds:G(t.match.params.category)(e),category:t.match.params.category,currentArticle:te(e),username:q(e)}})),Fe=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).ref=a.a.createRef(),n.columnCount=0,n.getArticleCard=function(e){var t=e.columnIndex,r=e.rowIndex,o=e.style,c=e.key,i=(e.parent,e.isVisible),s=t+r*n.columnCount;if(s>=n.props.articleIds.length)return a.a.createElement("div",{style:o,key:c});var l=n.props.articleIds[s];return a.a.createElement("div",{key:c,ref:n.ref,style:Object(T.a)({},o,{display:"flex",justifyContent:"center",alignItems:"flex-start"})},a.a.createElement(Ye,{category:n.props.category,articleId:l,shouldNotRenderInFull:!i,style:{width:"12rem"}}))},n.state={annotatedArticleCount:0},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;me(this.props.category),this.updateAnnotatedArticleCount(),setTimeout((function(){if(e.props.currentArticle&&e.props.category===e.props.currentArticle.category&&e.ref&&e.ref.current&&e.ref.current.parentElement){var t=e.ref.current.parentElement.parentElement;if(null===t)return;var n=e.props.articleIds.indexOf(e.props.currentArticle.articleId);t.scrollTo(0,360*Math.floor(n/e.columnCount)-100)}}),0)}},{key:"componentDidUpdate",value:function(){this.updateAnnotatedArticleCount()}},{key:"updateAnnotatedArticleCount",value:function(){var e=this;ge.emit("get annotated article count",{category:this.props.category,annotator:this.props.username},(function(t){e.setState({annotatedArticleCount:t})}))}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{style:{width:"100%",height:"100vh"}},a.a.createElement(i.b,{to:"/",style:{padding:".25rem 1rem",textDecoration:"none",color:"#333",position:"fixed",top:"0",backgroundColor:"rgba(255, 255, 255, .8)",zIndex:1e6}},"Go Back"),a.a.createElement("span",{style:{padding:".25rem 1rem",textDecoration:"none",color:"#333",position:"fixed",top:"0",right:"0",backgroundColor:"rgba(255, 255, 255, .8)",zIndex:1e6}},this.state.annotatedArticleCount," / ",(this.props.articleIds||[]).length),a.a.createElement(Ke.a,null,(function(t){var n=t.height,r=t.width;return e.columnCount=Math.floor(r/240),a.a.createElement(Ke.b,{className:"article-card-panel-container",cellRenderer:e.getArticleCard.bind(e),width:r,height:n,columnWidth:(r-32)/e.columnCount,columnCount:e.columnCount,rowHeight:360,rowCount:Math.ceil((e.props.articleIds||[]).length/e.columnCount)})})))}}]),t}(a.a.Component),qe=Object(f.f)(Xe(Fe)),We=Object(h.b)((function(e){return{categories:e.utils.categories}}))(function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){fe.emit("refresh category list",(function(e){ce.dispatch({type:"SET_CATEGORY_LIST",categories:e})}))}},{key:"render",value:function(){return a.a.createElement("div",{className:"category-panel"},this.props.categories.map((function(e){return a.a.createElement(i.b,{to:"/".concat(e),key:e,className:"category-card"},e)})))}}]),t}(a.a.Component)),Be=n(53),ze=Object(h.b)(null,(function(e){return{setUsername:function(t){e({type:"CHANGE_USERNAME",username:t})}}}))(function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={username:""},n.handleChange=n.handleChange.bind(Object(Be.a)(n)),n.changeUsername=n.changeUsername.bind(Object(Be.a)(n)),n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"handleChange",value:function(e){this.setState({username:e.target.value})}},{key:"changeUsername",value:function(){this.props.setUsername&&(this.props.setUsername(this.state.username),pe(this.state.username))}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"username-container"},a.a.createElement("input",{placeholder:"Username",className:"username-input",onKeyPress:function(t){"Enter"===t.key&&e.changeUsername()},onChange:this.handleChange}),a.a.createElement("span",{className:"username-button",onClick:this.changeUsername},"Set Username"))}}]),t}(a.a.Component));window.displayOthersAnnotation=function(){ce.dispatch({type:"DISPLAY_OTHERS_ANNOTATION"})};var Je=Object(h.b)((function(e){return{isUserLoggedIn:W(e),username:q(e)}})),Ze=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.props.isUserLoggedIn&&this.props.username&&pe(this.props.username)}},{key:"render",value:function(){return this.props.isUserLoggedIn?a.a.createElement(f.c,null,a.a.createElement(f.a,{path:"/:category/:articleId",component:Te}),a.a.createElement(f.a,{path:"/:category",component:qe}),a.a.createElement(f.a,{path:"/",component:We})):a.a.createElement(ze,null)}}]),t}(a.a.Component),$e=Object(f.f)(Je(Ze));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(a.a.createElement(h.a,{store:ce},a.a.createElement(i.a,{basename:"article-annotator"},a.a.createElement($e,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[141,1,2]]]);
//# sourceMappingURL=main.a4f8657f.chunk.js.map